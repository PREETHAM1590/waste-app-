<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Waste Wise Token Tester</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #121a2a;
      --text: #e8f0ff;
      --muted: #a5b4d4;
      --primary: #2dd4bf;
      --accent: #22c55e;
      --warn: #f59e0b;
      --error: #ef4444;
      --border: #263249;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background: var(--bg); color: var(--text); }
    .container { max-width: 980px; margin: 40px auto; padding: 0 16px; }
    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.25); }
    h1 { font-size: 22px; margin: 0 0 16px; }
    h2 { font-size: 16px; margin: 18px 0 10px; color: var(--muted); }
    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input, select, button, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #0e1626; color: var(--text); }
    input:focus, select:focus, textarea:focus { outline: 2px solid var(--primary); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .btn { cursor: pointer; background: var(--primary); border: none; color: #001010; font-weight: 700; letter-spacing: .2px; }
    .btn.secondary { background: var(--accent); }
    .btn.warn { background: var(--warn); color: #1f1500; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .muted { color: var(--muted); font-size: 12px; }
    .log { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; white-space: pre-wrap; background: #0a1020; padding: 12px; border-radius: 10px; border: 1px solid var(--border); max-height: 260px; overflow: auto; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .tag { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #0c1b2f; border: 1px solid var(--border); }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <h1>Waste Wise Token Tester <span class="tag" id="envTag">env</span></h1>
      <div class="grid">
        <div>
          <h2>Configuration</h2>
          <label>API Base URL</label>
          <input id="apiBase" value="http://localhost:3001" />
          <div class="row">
            <div>
              <label>Wallet Address (Solana)</label>
              <input id="wallet" placeholder="Enter your Solana address" />
            </div>
            <div>
              <label>User ID</label>
              <input id="userId" placeholder="e.g. user123" />
            </div>
          </div>
          <div class="row" style="margin-top:8px;">
            <button class="btn" id="btnTokenInfo">Get Token Info</button>
            <button class="btn secondary" id="btnBalance">Check Balance</button>
          </div>
          <div class="row" style="margin-top:8px;">
            <button class="btn warn" id="btnAirdrop">Airdrop 1 SOL (devnet)</button>
            <button class="btn" id="btnProcessQueue">Process Queue</button>
          </div>
        </div>
        <div>
          <h2>Quick Scan Reward</h2>
          <div class="row">
            <div>
              <label>Item Type</label>
              <select id="itemType">
                <option value="plastic_bottle">Plastic Bottle</option>
                <option value="paper">Paper</option>
                <option value="glass">Glass</option>
                <option value="metal_can">Metal Can</option>
                <option value="cardboard">Cardboard</option>
              </select>
            </div>
            <div>
              <label>Confidence (0-1)</label>
              <input id="confidence" type="number" step="0.01" min="0" max="1" value="0.95" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Classification</label>
              <select id="classification">
                <option value="recyclable">Recyclable</option>
                <option value="non_recyclable">Non-Recyclable</option>
                <option value="compost">Compost</option>
              </select>
            </div>
            <div>
              <label>Is Correct?</label>
              <select id="isCorrect">
                <option value="true">True</option>
                <option value="false">False</option>
              </select>
            </div>
          </div>
          <button class="btn" id="btnScan" style="margin-top:8px;">Send Scan Reward</button>
        </div>
      </div>
    </div>

    <div class="panel" style="margin-top:16px;">
      <h2>Logs</h2>
      <div id="log" class="log"></div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const log = (msg, obj) => {
      const ts = new Date().toISOString();
      const line = typeof obj !== 'undefined' ? `${ts} — ${msg} \n${JSON.stringify(obj, null, 2)}\n` : `${ts} — ${msg}\n`;
      $('log').textContent = line + "\n" + $('log').textContent;
    };

    const get = async (path) => {
      const res = await fetch($('apiBase').value + path);
      return res.json();
    };
    const post = async (path, body) => {
      const res = await fetch($('apiBase').value + path, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      return res.json();
    };

    $('envTag').textContent = 'development';

    $('btnTokenInfo').onclick = async () => {
      try {
        const data = await get('/api/rewards/token-info');
        log('Token info', data);
      } catch (e) { log('Token info failed', e); }
    };

    $('btnBalance').onclick = async () => {
      const addr = $('wallet').value.trim();
      if (!addr) return alert('Enter wallet address');
      try {
        const data = await get('/api/rewards/balance/' + addr);
        log('Balance', data);
      } catch (e) { log('Balance failed', e); }
    };

    $('btnAirdrop').onclick = async () => {
      const addr = $('wallet').value.trim();
      if (!addr) return alert('Enter wallet address');
      try {
        const data = await post('/api/rewards/airdrop-sol', { walletAddress: addr, amount: 1 });
        log('Airdrop SOL (devnet)', data);
      } catch (e) { log('Airdrop failed', e); }
    };

    $('btnProcessQueue').onclick = async () => {
      try {
        const data = await post('/api/rewards/process-queue', {});
        log('Process queue', data);
      } catch (e) { log('Process queue failed', e); }
    };

    $('btnScan').onclick = async () => {
      const addr = $('wallet').value.trim();
      const userId = $('userId').value.trim() || 'demo-user';
      if (!addr) return alert('Enter wallet address');
      try {
        const payload = {
          userId,
          walletAddress: addr,
          itemType: $('itemType').value,
          classification: $('classification').value,
          confidence: parseFloat($('confidence').value || '0.9'),
          isCorrect: $('isCorrect').value === 'true',
          location: 'Web Tester'
        };
        const data = await post('/api/rewards/scan', payload);
        log('Scan reward', data);
      } catch (e) { log('Scan reward failed', e); }
    };
  </script>
</body>
</html>

